# 数据库系统课设

## 系统分析

### 开发背景

目前全国酒店行业发展开始趋于稳定，单纯继续发展酒店数量无法大跨度提 升酒店在市场中的竞争实力，所以现在酒店市场开始脱离量的变化，开始追求的 质的提升，而智慧酒店概念和体系的引入成为了酒店“升级”的热门选择。 就项目初开展地桂林而言，桂林是著名的旅游城市。从 2017 年至今，年游 客流量同比增长速率一直在 20%以上，随着国民经济水平的提高旅游业也得到了 空气的发展，桂林市政府也就旅游等服务业推出过《桂林市现代服务业发展“十 三五”规划》等鼓励政策。因此在旅游业发达且呈上升趋势的城市开展项目最适 合不过了。

### 市场分析

#### 行业发展程度和动态 

智慧酒店这个行业现如今是属于前景良好,资金投入中庸，发展速度近几年 才快，整体来说是处于一种市场空缺大，但是做好并引领难的地步。现在的发展 动态是大型企业已经开始介入，智慧酒店市场再次掀起波澜，充满机遇但风险也 高

#### 创新和技术占比

在这个行业创新和技术始终扮演者重要角色，哪家公司的技术更新，更成熟，更有保障，无疑会成为竞争市场的有力手段。而创新不管是模式还是技术， 对于任何行业都是占比极大的一块。虽然智慧酒店行业发展方向和执行手段相差 不会很大，但是商业模式的创新和对象选择的创新都是可以对改变市场格局的重 要影响，所以创新和技术在智慧酒店这个行业中扮演者影响市场发展的角色之 一。 

#### 行业资金投入和发展趋势 

目前全国主要城市的酒店智能化改造市场已经超过 1000 亿元，且每年酒店 数量还有 20%左右的增长，这是酒店升质和提量的重要体现。除此之外，阿里巴 巴等大型企业的资本投入必然会使智慧酒店行业的资金投入在未来持续增长，其 资本透入也代表智慧酒店行业的发展开始走向飞速发展阶段。由此可以看出，未10 来酒店智能系统应用前景非常广阔。 

####  经济发展和政府对该行业的影响 

智慧酒店行业的本质就是服务业，属于非必须发展对象，所以受经济影响比较大，但是成型的智慧酒店影响不大，只是经济会影响酒店方面是否继续改造酒 店的念头，进而影响整体行业的发展。在政府方面一直是积极鼓励的，因为智慧 酒店在为酒店增益和升级的同时也是给当地城市的酒店行业提高品级和形象。为 当地的经济发展做出贡献，尤其是对旅游业发达的地区，是提升当地旅游形象的 绝佳选择，因此政府一直都是鼓励智慧酒店的发展。



### 系统的任务和特点

（这个临时加的，）

### 功能需求



根据智慧酒店的特点并考虑用户入住智慧酒店的实际需求，我们设计的智慧酒店系统的预期功能包含两个模块：第一，服务酒店管理员的管理模块；第二，服务客户的使用模块，系统结构图如图1所示：

（图1）

管理员模块

房间管理：实现管理员对房间的控制，允许管理员查看房间的开门记录、入住信息、房间当前温度、房间的硬件状态信息等信息；允许管理员对房间的硬件设施进行操控；允许管理员对房间的价钱、类型、房间名称等信息进行修改。

订单管理：允许管理员对订单进行查看、修改、增添、删除等操作。

用户管理：允许管理员对用户信息、权限等进行查看、修改、增添、删除等操作。

权限管理：允许对不同的等级管理员进行权限管理，对其权限进行查看、修改、增添、删除等操作。

统计数据：统计基本的酒店营业信息，如统计近一周内入住的人数、营业额等信息。

可视化数据：对统计出的数据进行可视化处理，如可视化的列出入住人数变化的曲线；实现订单信息导出功能等。

用户模块

入住实现：该子模块主要实现用户浏览已有房间信息、预定房间、退订房间等功能。

信息查询：该子模块主要实现用户查看自己的订单信息、房间信息（查看温度、湿度等信息）。

房间管理：该子模块主要实现对房间设施的控制管理，通过人脸识别的方式实现开门的操作，好友来访时向用户推送询问是否开门的消息；用户对房内基础设施如空调，电灯等设备的控制。



### 用户需求分析

ps:用户需求的图，对图进行说明



### 业务流程

画图

### 可靠性分析

1.故障的频率及严重性

故障频率低，严重性小。

2.可恢复性
软件突然崩溃或者发生错误后应该可以回滚到上一次的操作中，忽略当前此次操作。

3.可预见性
当点击某些控件时候，在会发生错误或者数据修改时候应当给与必要的提示。



### 可用性分析

1.人员因素
财务系统保密性高，对此应该加强安全措施。

2.用户界面需求
界面美观，便于操作。

3.用户文档和培训材料
在提交软件时期应该附带用户文档以及必要的培训材料,以使得财务人员可以更快的适应新的软件。

 

### 接口需求

 

#### 界面设计

分析与讨论后，将智慧酒店系统的界面设计为两大部分：小程序界面和网页界面。

小程序界面：



网页界面：

1. 登录界面：提供管理系统的登录界面，界面要求简洁美观。
2. 首页：显示酒店近期内的统计数据，如近期入住人数、近期订单成交数、近期盈利额等。显示一周内的统计数据的变化曲线图。
3. 用户管理界面：以表格的形式展示各个用户的信息，如姓名、身份证号、权限登记等信息。并提供可以对数据进行增加、修改、筛选和删除的按钮或子页面。
4. 订单信息管理界面：以表格的形式展示各个订单的信息，如订单编号、预计输住时间等信息。并提供可以对数据进行增加、修改、筛选和删除的按钮或子页面。
5. 酒店运行状况查看界面：以曲线图/柱状图的形式显示酒店近两周内的统计数据。统计数据包括近期入住人数、近期订单成交数和近期盈利三项。以天为单位对统计数据进行显示。
6. 房间信息管理界面：以表格的形式展示每个房间的信息，如房间号、房间价格、房间温度、房间湿度等信息。并提供可以对数据进行增加、修改、筛选和删除的按钮或子页面。
7. 管理员个人信息页面：显示当前管理员的个人信息。
8. 用户建议界面：以表格的形式展示用户上传的建议。

#### 小程序接口



#### 网页接口

说明：接口数据全部以JSON数据格式进行传输。具体API接口说明请参考附录—网页API接口说明。

统计数据相关接口：

1. 获取一周内/两周内入住人数、订单成交数、盈利额和用户建议的数量
2. 获取每日的入住人数、订单成交数、盈利额和建议的数量

用户信息管理相关接口：

1.  获取用户数据表中的个人数据的接口
2.  像用户数据表中添加数据的接口
3.  修改用户数据表中的数据的接口
4.  删除用户数据表中的数据的接口

订单信息管理相关接口：

1.  获取订单数据表中的订单数据的接口
2.  像用订单数据表中添加数据的接口
3.  修改订单数据表中的数据的接口
4.  删除订单数据表中的接口

房间信息管理相关接口：

1. 获取房间数据表中的订单数据的接口
2. 像用房间数据表中添加数据的接口
3. 修改房间数据表中的数据的接口
4. 删除房间数据表中的接口

管理员个人信息相关接口：

1. 获取管理员个人信息的接口

用户建议查看相关接口：

1. 获取用户提交的建议的接口
2. 删除用户提交的建议的接口

### 安全需求

#### 用户安全性需求

对于操作系统，网络系统以及数据库都有比较高的安全需求。
1.限制不必要的用户。经常检查系统的用户，删除已经不再使用的用户。

2.预设一位超级管理员，拥有最高级权限，用于对其他用户的仅限监管和权限管理。设置多名酒店业务管理员负责处理一些酒店的业务数据等操作。剩下的都为普通用户。最高级管理员权限使用3来标识，酒店业务管理员权限用2来标识，普通用户权限用1来标识。

3.登陆验证策略，（等我问问博阁）

#### 密码安全性需求

具体要求如下：

1.使用密码策略，限制密码的最小长度为8，要求密码中含有英文大小写字母，以避免弱口令的发生。

2.设置用户尝试次数，连续3次输入密码错误后锁定该账号30分钟，第五次输入密码错误后锁定24h，用于防范对账号密码的暴力破解。



#### 系统安全性需求

智慧酒店管理系统的系统安全性主要体现在系统保密性、系统完整性、可用性与抗毁性、系统防病毒四个方面：

系统保密性：只有授权的用户才能动用和修改信息系统的信息，且必须防止信息的非法修改和未授权泄漏。

系统完整性：信息必须以其原形被授权的用户所用只有授权的用户才能修改信息。

可用性与抗毁性：设置备份系统、容错机制，防止在系统出现单点失败时，系统的备份机制可以保证系统的正常运行。

系统防病毒：定时对系统进行安全扫描，发现病毒后及时清除。

此外，将智慧酒店管理系统搭建在酒店的内网中，不在公网中显现，借此来减少被攻击的次数。

#### 服务安全性需求

对于管理系统和微信小程序的后端服务器，检查有无高危端口，关闭不必要端口对端口进行放行限制。使用端口扫描器扫描系统已开放的端口，分析统计系统开放的哪些服务可能引起黑客入侵，实时监控这些端口状态。设置好安全记录的访问权限。安全记录在默认情况下是没有保护的，把它设置成只有管理员和系统账户才有权访问。

对于微信小程序对外开放的后端接口，每次访问需对用户身份进行校验，且数据包数据需具有时效性。身份验证通过时间戳加密钥等技术实现数据包不可重复发送。避免恶意抓包导致的信息泄漏、越权等问题。

 



## 系统数据库设计

### 系统模块划分

主要就是一张功能图

### 数据库关系分析

根据上述的需求调研，可以将数据库的关系抽象为如下描述：

一个住户可以预定多个房间（产生多个订单）。一个订单只属于一个住户。住户可以对每个房间内的多个智能家居进行控制。一个酒店管理人员可以管理多个订单，对订单信息进行修改，确认每个订单的入住日期和结账离开日期。一个订单也可以被多个管理人员管理。一个房间对应多条开门记录，一条开门记录只对应一个房间。一个管理人员可以查看多个房间的开门记录。一条开门记录可以被多个管理员查看。一个房间内置多个智能家居。一个智能家居只属于一个房间。

### 数据库逻辑结构设计

数据库的关系模型根据数据模型来确定,即将关系模型转化为SL- Server数据库系统所支持 的实际数据模型,得到数据库的逻辑结构。在数据库的关系模型及系统处理过程中的数据的结构 的基础上,获得系统数据库表以及表之间的关系。在本系统中,以下是系统中几个主要的数据依赖和数据库表结构。

逻辑依赖.....

### 数据库物理结构设计

本系统依据上述的关系模型建立了八张关系表，它们的表名以及对应的名称如表2-1所示：

|        表名         |      备注      |
| :-----------------: | :------------: |
|      resident       |   住户信息表   |
|        admin        |  管理员信息表  |
|     user_level      |     身份表     |
|        order        |   订单信息表   |
|        room         |   房间信息表   |
|  air_conditioning   | 智能空调信息表 |
|        light        |  智能灯信息表  |
| door_opening_record | 开门记录信息表 |

#### 数据库住户信息表 (resident)

住户信息表主要用于存储住户的信息，如姓名，性别等。通过该表可以操作每一个住户的信息。在数据表中id（用户编号）为主码。 wecharid为微信用户的唯一标志代号可用于区分用户的身份。该表如表2-2所示：

| 字段名   |   数据类型   | 是否为主键 | 是否为外键 |       检查规则       |             备注             |
| -------- | :----------: | :--------: | :--------: | :------------------: | :--------------------------: |
| wecharid | VARCHAR( 10) |     是     |     否     |   NOT NULL;UNIQUE    | 微信id，微信用户的唯一标识； |
| name     |   CHAR(4)    |     否     |     否     |          无          |         酒店住户姓名         |
| sex      |   CHAR(4)    |     否     |     否     | sex='男' or sex='女' |         酒店住户性别         |
| id_card  | VARCHAR(10)  |     否     |     否     |        UNIQUE        |       酒店住户身份证号       |
| phone    | VARCHAR(10)  |     否     |     否     |        UNIQUE        |       酒店住户电话号码       |

#### 数据库管理员信息表 (admin)

管理员信息表主要用于储存管理员的信息，如id（管理员编号），联系电话等信息。该表如表2-3所示：

|  字段名  |   数据类型   | 是否为主键 | 是否为外键 |       检查规则       |             备注             |
| :------: | :----------: | :--------: | :--------: | :------------------: | :--------------------------: |
| wecharid | VARCHAR( 10) |     是     |     否     |   NOT NULL;UNIQUE    | 微信id，微信用户的唯一标识； |
|   name   |   CHAR(4)    |     否     |     否     |          无          |        管理员住户姓名        |
|   sex    |   CHAR(4)    |     否     |     否     | sex='男' or sex='女' |        管理员住户性别        |
|  phone   | VARCHAR(10)  |     否     |     否     |        UNIQUE        |        管理员电话号码        |

#### 数据库身份表(user_level)

身份表主要用于保存使用者的身份信息。由于管理员和住户都是用wecharid作为唯一身份验证，所以系统使用身份表来存储wecharid和身份的对应关系。level为0表示该wecharid对应的用户为普通用户。level为1表示该用户为清洁人员具有使用小程序打开门锁的权限。level为2表示该用户为酒店管理人员具有所有的权限。该表如表2-4所示：

|  字段名  |   数据类型   | 是否为主键 | 是否为外键 |    检查规则     |             备注             |
| :------: | :----------: | :--------: | :--------: | :-------------: | :--------------------------: |
| wecharid | VARCHAR( 10) |     是     |     否     | NOT NULL;UNIQUE | 微信id，微信用户的唯一标识； |
|  level   |     INT      |     否     |     否     |    NOT NULL     |         用户等级表示         |

#### 数据库订单信息表 (order)

订单信息表主要用于保存用户的订单信息，如应付金额，入住日期等。在设计上用户和订单是一对多的关系，订单与房间是1对1的关系。在表中订单编号为主键。同时该表参照resident表的wecharid作为外键和room表的房间id作为外键，该表如表2-5所示：

|  字段名  |   数据类型   | 是否为主键 | 是否为外键 |    检查规则     |            备注            |
| :------: | :----------: | :--------: | :--------: | :-------------: | :------------------------: |
|    id    |     INT      |     是     |     否     | NOT NULL;UNIQUE |     订单编号，主键自增     |
|  pmoney  |     INT      |     否     |     否     |    NOT NULL     |        订单应付金额        |
|   scid   |   DATETIME   |     否     |     否     |    NOT NULL     |        预定入住日期        |
|   sgo    |   DATETIME   |     否     |     否     |    NOT NULL     |        预计离开日期        |
|   cid    |   DATETIME   |     否     |     否     |       无        |        实际入住日期        |
|    go    |   DATETIME   |     否     |     否     |       无        |        结账离开日期        |
| wecharid | VARCHAR( 10) |     否     |     是     |       无        | 微信id，微信用户的唯一标识 |
| room_id  |     INT      |     否     |     是     |       无        |          房间编号          |

#### 数据库房间信息表

房间信息表主要包括了房间的基本信息，如房间类型，房间编号等。其中还包括房间温度、房间湿度等状态信息。状态信息在设计上是由房间内传感器进行动态更新。房间与智慧家居是一对多的关系，与订单是1对1的关系。该表如表2-6所示：

|   字段名    | 数据类型 | 是否为主键 | 是否为外键 |    检查规则     |        备注        |
| :---------: | :------: | :--------: | :--------: | :-------------: | :----------------: |
|     id      |   INT    |     是     |     否     | NOT NULL;UNIQUE | 房间编号，主键自增 |
|    money    |   INT    |     否     |     否     |    NOT NULL     |    房间金额/日     |
| temperature |  FLOAT   |     否     |     否     |    NOT NULL     |    房间当前温度    |
|  humidity   |  FLOAT   |     否     |     否     |    NOT NULL     |    房间当前湿度    |
|    rtype    | CHAR(10) |     否     |     否     |    NOT NULL     |      房间类型      |

#### 数据库智能空调信息表

智能空调信息表中包括了各个房间空调的数值和状态。同时该表使用room表的房间编号作为外键约束。 空调与房间为1对1的关系，一个房间只有一个空调。该表如表2-7所示：

| 字段名  | 数据类型 | 是否为主键 | 是否为外键 |       检查规则       |         备注         |
| :-----: | :------: | :--------: | :--------: | :------------------: | :------------------: |
|   id    |   INT    |     是     |     否     |   NOT NULL;UNIQUE    |  空间编号，主键自增  |
| status  |   INT    |     否     |     否     | status=0 or status=1 | 0表示关闭，1表示开启 |
| air_tmp |  FLOAT   |     否     |     否     |       NOT NULL       |     空调当前温度     |
| room_id |   INT    |     否     |     是     |          无          |       房间编号       |

#### 数据库智能灯信息表

智能灯信息表中包括了各个房间灯的数值和状态。同时该表使用room表的房间编号作为外键约束。 灯与房间为多对1的关系，一个房间可以有多个智能灯。该表如表2-8所示：

| 字段名  | 数据类型 | 是否为主键 | 是否为外键 |       检查规则       |         备注         |
| :-----: | :------: | :--------: | :--------: | :------------------: | :------------------: |
|   id    |   INT    |     是     |     否     |   NOT NULL;UNIQUE    |   灯编号，主键自增   |
| status  |   INT    |     否     |     否     | status=0 or status=1 | 0表示关闭，1表示开启 |
| air_tmp |  FLOAT   |     否     |     否     |       NOT NULL       |     灯当前的亮度     |
| room_id |   INT    |     否     |     是     |          无          |       房间编号       |

#### 数据库开门记录信息表

开门记录信息表记录了每个房间使用小程序打开门的时间和开门人的wecharid。一个房间可以对应多条开门记录。该表如表2-9所示

|  字段名   |   数据类型   | 是否为主键 | 是否为外键 |    检查规则     |            备注            |
| :-------: | :----------: | :--------: | :--------: | :-------------: | :------------------------: |
|    id     |     INT      |     是     |     否     | NOT NULL;UNIQUE |     记录编号，主键自增     |
| wecharid  | VARCHAR( 10) |     否     |     否     |    NOT NULL     | 微信id，微信用户的唯一标识 |
| open_time |   DATETIME   |     否     |     否     |    NOT NULL     |         开门的时间         |
|  room_id  |     INT      |     否     |     否     |    NOT NULL     |          房间编号          |
| Identity  |     INT      |     否     |     否     |    NOT NULL     |         开门人身份         |

## 系统功能设计

每个功能写的时候需要包括功能描述，功能过程图，关键代码，界面

### 预定管理功能设计

#### 预定房间

#### 预定入住

#### 解除预定

### 手机端管理员功能设计

#### 查看各房间信息

#### 手机开门

### 智能家居控制设计

#### 查看对应房间的基本信息

#### 控制房间家具

### 

## 系统安全性设计

## 测试

### 客户端测试

### 管理员端测试

## 关键技术总结

### 前端关键技术总结

### 后端关键技术总结

## 存在的问题及改进思路

## 总结

